<div class="layout">
    <app-side-menu></app-side-menu>

    <div class="page-wrapper">
        <div class="card">
            <div class="logo-container">
                <img src="/Zetta.jpg" alt="Logo Zetta" class="logo-img">
            </div>

            <div class="header">
                <span class="header-icon">游닄</span>
                <h1>Formulario de matriculaci칩n</h1>
            </div>

            <!-- Error banner -->
            <div class="error-banner" *ngIf="errorMsg">
                {{ errorMsg }}
            </div>

            <form [formGroup]="form" (ngSubmit)="addMatricula()">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="curso">Curso</label>
                        <select id="curso" formControlName="curso">
                            <option value="">Seleccion치 un curso</option>
                            <option *ngFor="let c of cursos" [value]="c.nombre">{{ c.nombre }}</option>
                        </select>
                        <small class="error" *ngIf="required('curso')">El curso es obligatorio</small>
                    </div>

                    <div class="form-group">
                        <label for="fecha">Fecha de matr칤cula</label>
                        <input id="fecha" type="date" formControlName="fecha">
                        <small class="error" *ngIf="required('fecha')">La fecha es obligatoria</small>
                    </div>

                    <div class="form-group">
                        <label for="alumno">Alumno</label>
                        <input id="alumno" type="text" placeholder="Apellidos y nombres" formControlName="alumno">
                        <small class="error" *ngIf="required('alumno')">El nombre es obligatorio</small>
                        <small class="error" *ngIf="minLen('alumno', 3)">M칤nimo 3 caracteres</small>
                    </div>

                    <div class="form-group">
                        <label>Sexo</label>
                        <div class="radio-group">
                            <label class="radio-option"><input type="radio" value="Masculino" formControlName="sexo">
                                Masculino</label>
                            <label class="radio-option"><input type="radio" value="Femenino" formControlName="sexo">
                                Femenino</label>
                        </div>
                        <small class="error" *ngIf="required('sexo')">Seleccion치 una opci칩n</small>
                    </div>

                    <div class="form-group">
                        <label for="direccion">Direcci칩n</label>
                        <input id="direccion" type="text" placeholder="Ingrese su direcci칩n"
                            formControlName="direccion">
                        <small class="error" *ngIf="required('direccion')">La direcci칩n es obligatoria</small>
                    </div>

                    <div class="form-group">
                        <label for="provincia">Provincia</label>
                        <select id="provincia" formControlName="provincia">
                            <option value="">Seleccion치 una provincia</option>
                            <option>Buenos Aires</option>
                            <option>CABA</option>
                            <option>Chubut</option>
                            <option>Corrientes</option>
                            <option>C칩rdoba</option>
                            <option>Entre R칤os</option>
                            <option>Jujuy</option>
                            <option>La Rioja</option>
                            <option>Mendoza</option>
                            <option>Misiones</option>
                            <option>Neuqu칠n</option>
                            <option>R칤o Negro</option>
                            <option>Salta</option>
                            <option>San Luis</option>
                            <option>Santa Fe</option>
                            <option>Tierra del Fuego</option>
                        </select>
                        <small class="error" *ngIf="required('provincia')">La provincia es obligatoria</small>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn-primary" type="submit" [disabled]="form.invalid">游 Guardar</button>
                    <button class="btn-secondary" type="button" (click)="resetForm()">游댃 Limpiar</button>

                    <button class="btn-success" type="button" (click)="mostrarTabla = !mostrarTabla">游늶 Ver
                        Matr칤culas</button>
                </div>
            </form>

            <!-- Tabla de matriculas -->
            <section *ngIf="mostrarTabla" class="table-section">
                <div class="table-header">
                    <h3>Matriculas registradas ({{ matriculas.length }})</h3>
                    <div class="export-buttons">
                        <button class="btn-secondary" (click)="exportExcel()">Exportar Excel</button>
                        <button class="btn-secondary" (click)="exportPDF()">Exportar PDF</button>
                    </div>
                </div>

                <table class="modern-table" *ngIf="matriculas.length > 0; else noData">
                    <thead>
                        <tr>
                            <th>Alumno</th>
                            <th>Curso</th>
                            <th>Fecha</th>
                            <th>Sexo</th>
                            <th>Provincia</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let m of matriculas">
                            <td>{{ m.alumno }}</td>
                            <td>{{ m.curso }}</td>
                            <td>{{ m.fecha }}</td>
                            <td>{{ m.sexo }}</td>
                            <td>{{ m.provincia }}</td>
                            <td>
                                <button class="btn btn-primary" (click)="editarMatricula(m.id)">Editar</button>
                                <button class="btn btn-secondary" (click)="eliminarMatricula(m.id)">Eliminar</button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <ng-template #noData>
                    <div class="empty">No hay matr칤culas registradas</div>
                </ng-template>
            </section>

            <!-- MODAL (confirm / info / error) -->
            <div class="modal-backdrop" *ngIf="showConfirmModal">
                <div class="modal" [ngClass]="{'modal-error': modalType === 'error'}">
                    <h2 *ngIf="modalType === 'error'" class="error-title">Error</h2>
                    <h2 *ngIf="modalType === 'info'">Informaci칩n</h2>
                    <h2 *ngIf="modalType === 'confirm'">Confirmaci칩n</h2>

                    <div class="modal-row">
                        <span>{{ confirmMessage }}</span>
                    </div>

                    <div class="modal-actions" *ngIf="modalType === 'confirm'">
                        <button class="btn btn-secondary modal-btn" (click)="onModalConfirm(false)">Cancelar</button>
                        <button class="btn btn-primary modal-btn" (click)="onModalConfirm(true)">Aceptar</button>
                    </div>

                    <div *ngIf="modalType !== 'confirm'">
                        <button class="btn btn-primary modal-btn" (click)="onModalConfirm(true)">Aceptar</button>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>